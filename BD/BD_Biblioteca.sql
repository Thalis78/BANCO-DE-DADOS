CREATE TABLE LEITOR (
CPF BIGINT NOT NULL PRIMARY KEY,
NOME_LT VARCHAR(20) NOT NULL,
FONE_LT INT NOT NULL,
CEP_LT INT NOT NULL);

ALTER TABLE LEITOR ALTER COLUMN FONE_LT TYPE BIGINT;

CREATE TABLE FUNCIONARIO (
MATRICULA INT NOT NULL PRIMARY KEY,
NOME_FN VARCHAR(20) NOT NULL,
FONE_FN INT NOT NULL,
CEP_FN INT NOT NULL);

ALTER TABLE FUNCIONARIO ALTER COLUMN FONE_FN TYPE BIGINT;

CREATE TABLE AUTOR (
COD_AT INT NOT NULL PRIMARY KEY,
NOME_AT VARCHAR(20) NOT NULL,
DESCRICAO_AT VARCHAR(30) NOT NULL,
GENERO_AT VARCHAR(20) NOT NULL);

ALTER TABLE AUTOR ALTER COLUMN DESCRICAO_AT TYPE VARCHAR(60);

CREATE TABLE TITULO (
COD_TL INT NOT NULL PRIMARY KEY,
NOME_TL VARCHAR(20) NOT NULL,
LOCALIZACAO CHAR(4) NOT NULL);

ALTER TABLE TITULO ALTER COLUMN NOME_TL TYPE VARCHAR(40);

CREATE TABLE LIVRO (
COD_LV INT NOT NULL PRIMARY KEY,
COD_TL INT NOT NULL REFERENCES TITULO(COD_TL),
DESCRICAO_LV VARCHAR(30) NOT NULL,
STATUS CHAR(1) NOT NULL);

ALTER TABLE LIVRO ALTER COLUMN DESCRICAO_LV TYPE VARCHAR(130);

--TABELA COM CHAVE PRIMARIA COMPOSTA DE DOIS ATRIBUTOS.
CREATE TABLE AUTORIA (
COD_TL INT,
COD_AT INT,
PRIMARY KEY (COD_TL, COD_AT),
FOREIGN KEY (COD_TL) REFERENCES TITULO(COD_TL),
FOREIGN KEY (COD_AT) REFERENCES AUTOR(COD_AT));

CREATE TABLE RESERVA (
COD_RS INT NOT NULL PRIMARY KEY,
CPF BIGINT NOT NULL REFERENCES LEITOR(CPF),
COD_TL INT NOT NULL REFERENCES TITULO(COD_TL),
DT_RS DATE NOT NULL);

CREATE TABLE EMPRESTIMO (
COD_EM INT NOT NULL PRIMARY KEY,
COD_LV INT NOT NULL REFERENCES LIVRO(COD_LV),
CPF BIGINT NOT NULL REFERENCES LEITOR(CPF),
MATRICULA INT NOT NULL REFERENCES FUNCIONARIO(MATRICULA),
DT_EM DATE NOT NULL,
DT_PREV_DVL DATE NOT NULL,
DT_DVL DATE NULL);

INSERT INTO LEITOR VALUES
(13366954812, 'JÚLIA', 86999254123, 64006920),
(21254852956, 'HENRIQUE', 86981563216, 64006720),
(60240983292, 'AUGUSTO', 86994589632, 64006103);

INSERT INTO FUNCIONARIO VALUES 
(100001, 'AFONSO', 86998452189, 64006420),
(100002, 'MARTA', 86981547210, 64006820),
(100003, 'ALINE', 8699132986, 64006210);

INSERT INTO AUTOR VALUES 
(1001, 'OSMAR', 'AUTOR NORTISTA, NASCIDO EM 1962-12-01 EM PALMAS.', 'TERROR'),
(1002, 'ANGELA', 'AUTORA SULISTA, NASCIDA EM 1989-02-03 EM LONDRINA.', 'SUSPENSE'),
(1003, 'ROGER', 'AUTOR NORDESTINO, NASCIDO EM 1990-04-20 EM FEIRA DE SANTANA.', 'ROMANCE');

INSERT INTO TITULO VALUES 
(10001, 'A PROFECIA', 'E1P4'),
(10002, 'AS RUINAS', 'E1P2'),
(10003, 'O ILUMINADO', 'E2P5'),
(10005, 'O SILÊNCIO DOS INOCENTES', 'E2P1'),
(10006, 'PS EU TE AMO', 'E3P3'),
(10007, 'A SELEÇÃO', 'E3P3');

INSERT INTO LIVRO VALUES
(101, 10001, 'O LIVRO FALA SOBRE O SURGIMENTO DO ANTICRISTO NO MUNDO DE HOJE...', 'D'),
(102, 10002, '...UMA BUSCA POR SEU IRMÃO, QUE DESAPARECEU MISTERIOSAMENTE AO TENTAR ENCONTRAR RUÍNAS MAIAS...', 'D'),
(103, 10003, 'JACK TORRANCE CONSEGUE UM EMPREGO COMO ZELADOR NO HOTEL OVERLOOK DURANTE O INVERNO...', 'D'),
(105, 10005, 'CINCO MULHERES SÃO BRUTALMENTE ASSASSINADAS EM DIFERENTES LOCALIDADES DOS ESTADOS UNIDOS...','D'),
(106, 10006, 'GERRY E HOLLY ERAM NAMORADOS DE INFÂNCIA E FICARIAM JUNTOS PARA SEMPRE, ATÉ QUE O INIMAGINÁVEL ACONTECE E GERRY MORRE...', 'D'),
(107, 10007, 'PARA TRINTA E CINCO RAPARIGAS, A SELEÇÃO É A OPORTUNIDADE DE UMA VIDA...', 'D');

INSERT INTO AUTORIA VALUES
(10001, 1001), (10002, 1001), (10003, 1002), (10005, 1002),
(10006, 1003), (10007, 1003);

INSERT INTO RESERVA VALUES 
(10, 13366954812, 10002, '2023-10-11');

INSERT INTO EMPRESTIMO VALUES 
(1, 103, 13366954812, 100002, '2023-04-05', '2023-04-12', '2023-04-13'),
(2, 107, 21254852956, 100003, '2023-05-10', '2023-05-17', '2023-05-17'),
(3, 106, 21254852956, 100003, '2023-05-10', '2023-05-17', '2023-05-17'),
(4, 105, 60240983292, 100001, '2023-05-10', '2023-05-17', '2023-05-17'),
(5, 101, 60240983292, 100001, '2023-05-10', '2023-05-17', '2023-05-17');

INSERT INTO EMPRESTIMO(COD_EM, COD_LV, CPF, MATRICULA, DT_EM, DT_PREV_DVL) VALUES
(6, 102, 13366954812, 100003, '2023-11-24', '2023-12-01');

INSERT INTO EMPRESTIMO VALUES
(7, 103, 60240983292, 100001, '2023-05-10', '2023-05-17', '2023-05-17');

--OBTER O NOME DE TODOS OS FUNCIONARIOS:
SELECT NOME_FN FROM FUNCIONARIO;

--OBTER O NOME DOS LEITORES CEP QUE TERMINA EM "0":
/* NESSA CONSULTA %10 CALCULA O RESTO DA DIVISAO POR 10,
E A 'CONDIÇÃO CEP_LT %10 = 0' VERIFICA SE O ÚLTIMO DIGITO
DO CEP É '0'. */
SELECT NOME_LT FROM LEITOR WHERE CEP_LT % 10 = 0;

--OBTER O CODIGO E O NOME DOS AUTORES QUE TEM A LETRA 'A' NO NOME:
SELECT COD_AT,NOME_AT FROM AUTOR WHERE NOME_AT LIKE '%A%';

--OBTER O NOME E O CPF DOS LEITORES QUE FORAM ATENDIDOS PELOS FUNCIONARIOS AFONSO E ALINE:
SELECT NOME_LT,CPF FROM LEITOR WHERE CPF IN(SELECT CPF FROM EMPRESTIMO WHERE MATRICULA IN
									  (SELECT MATRICULA FROM FUNCIONARIO WHERE  
									   NOME_FN='AFONSO' OR NOME_FN='ALINE'));

SELECT NOME_FN FROM FUNCIONARIO WHERE MATRICULA IN
(SELECT MATRICULA FROM EMPRESTIMO WHERE COD_LV IN
(SELECT COD_LV FROM EMPRESTIMO WHERE MATRICULA IN
(SELECT MATRICULA FROM FUNCIONARIO WHERE NOME_FN='AFONSO'))) AND NOME_FN!= 'AFONSO';

SELECT NOME_FN FROM FUNCIONARIO WHERE NOME_FN!='JOAO' AND MATRICULA IN
(SELECT MATRICULA FROM EMPRESTIMO WHERE COD_LV IN
(SELECT COD_LV FROM EMPRESTIMO WHERE MATRICULA IN
(SELECT MATRICULA FROM FUNCIONARIO WHERE NOME_FN='JOAO')));

SELECT NOME_FN FROM FUNCIONARIO WHERE MATRICULA IN
(SELECT MATRICULA FROM EMPRESTIMO WHERE COD_LV IN
(SELECT COD_LV FROM EMPRESTIMO WHERE COD_LV IN
(SELECT COD_LV FROM LIVRO WHERE COD_LV IN
(SELECT COD_LV FROM EMPRESTIMO WHERE MATRICULA IN
(SELECT MATRICULA FROM FUNCIONARIO WHERE NOME_FN='AFONSO'))))) AND NOME_FN!='AFONSO';