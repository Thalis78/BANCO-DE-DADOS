CREATE TABLE PACIENTE (
CPF INT NOT NULL PRIMARY KEY,
NOME VARCHAR(20) NOT NULL,
CEP INT NOT NULL);

--Alterar o dominio do atributo cpf, pois não suporta 12 caract. do cpf.
ALTER TABLE PACIENTE ALTER COLUMN CPF TYPE BIGINT;
--ADICIONANDO UMA NOVA COLUNA A TABELA PACIENTE, POIS EU ESQUECI DE POR A DT:
ALTER TABLE PACIENTE ADD COLUMN DT_NASC DATE NOT NULL;

CREATE TABLE FUNCIONARIO (
MATRICULA INT NOT NULL PRIMARY KEY,
NOME VARCHAR(20) NOT NULL,
CEP INT NOT NULL);

CREATE TABLE ESPECIALIDADE (
COD_ESP INT NOT NULL PRIMARY KEY,
NOME VARCHAR(30) NOT NULL,
VALOR FLOAT NOT NULL);

CREATE TABLE MEDICO (
CRM INT NOT NULL PRIMARY KEY,
COD_ESP INT NOT NULL REFERENCES ESPECIALIDADE(COD_ESP),
NOME VARCHAR(20) NOT NULL,
CEP INT NOT NULL);

CREATE TABLE CONSULTA (
COD_CONS INT NOT NULL PRIMARY KEY,
CRM INT NOT NULL REFERENCES MEDICO(CRM),
CPF BIGINT NOT NULL REFERENCES PACIENTE(CPF),
MATRICULA INT NOT NULL REFERENCES FUNCIONARIO(MATRICULA),
DIAGNOSTICO VARCHAR(60) NOT NULL,
DT_CONSULTA DATE NOT NULL,
VALOR FLOAT NOT NULL);

DROP TABLE PACIENTE;
DELETE FROM PACIENTE;

INSERT INTO PACIENTE VALUES 
(05472010366, 'ALBERTO', 64006100, '2005-04-22'),
(13255366842, 'HELENA MARIA', 64006102, '1970-02-10'),
(33216548912, 'LUCAS LIMA', 64006700, '1945-06-29');

INSERT INTO FUNCIONARIO VALUES
(100001, 'HUGO', 64006109),
(100002, 'JULIA', 64006701),
(100003, 'HELIO', 64006109);

INSERT INTO ESPECIALIDADE VALUES
(1, 'CARDIOLOGIA', 255.65),
(2, 'GASTROENTEROLOGIA', 280.66),
(3, 'NEUROLOGIA', 525.75);

INSERT INTO MEDICO VALUES 
(630255, 3, 'JOAQUIM', 64006107),
(632289, 1, 'MARIA', 64006201),
(635712, 1, 'FRANCISCA', 64006107);

/*ESSES SELECTS SÃO PARA MOSTRAR DENTRO DA TABELA DE CONSULTA O VALOR DA CONSULTA,
BASEADO NA ESPECIALIDADE DO MEDICO*/
INSERT INTO CONSULTA VALUES
(20001, 630255, 05472010366, 100002, 'IDENTIFICADO ESCLEROSE MULTIPLA.', '2023-04-12', 
 (SELECT VALOR FROM ESPECIALIDADE WHERE COD_ESP=(SELECT COD_ESP FROM MEDICO WHERE CRM=630255))),
(20002, 635712, 33216548912, 100001, 'IDENTIFICADO ARRITIMIA CARDIACA.', '2023-05-29',
 (SELECT VALOR FROM ESPECIALIDADE WHERE COD_ESP=(SELECT COD_ESP FROM MEDICO WHERE CRM=635712))),
(20003, 630255, 33216548912, 100003, 'IDENTIFICADO DOENÇA DE PARKINSON.', '2023-05-29', 
 (SELECT VALOR FROM ESPECIALIDADE WHERE COD_ESP=(SELECT COD_ESP FROM MEDICO WHERE CRM=630255)));
 
 --Pesquisas no DB utilizando aquele pdf que professor passou como exercicio.
 
 --OBTER O NOME DE TODOS OS FUNCIONARIOS DA CLINICA:
 SELECT NOME FROM FUNCIONARIO;
 --OBTER O NOME DO PACIENTE QUE NASCERAM NO ANO DE 2005:
 SELECT NOME FROM PACIENTE WHERE DT_NASC >='2005-01-01' AND DT_NASC<='2005-12-31';
 --OBTER O NOME DOS PACIENTE QUE FORAM ATENDIDOS PELO MEDICO JOAQUIM OU PELA FUNCIONARIO JULIA:
 SELECT NOME FROM PACIENTE WHERE CPF IN (SELECT CPF FROM CONSULTA WHERE CRM IN
										 (SELECT CRM FROM MEDICO WHERE NOME='JOAQUIM'OR 
										  MATRICULA IN (SELECT MATRICULA FROM FUNCIONARIO WHERE NOME='JULIA')));
 --OBTER O NOME DO PACIENTE MAIS VELHO:
 --USEI A FUNÇÃO MIN PARA CALCULAR A DATA DO PACIENTE MAIS VELHO.
 SELECT NOME FROM PACIENTE WHERE DT_NASC=(SELECT MIN(DT_NASC) FROM PACIENTE);
 --OBTER O NOME DOS PACIENTES QUE NÃO FORAM ATENDIDOS PELA MEDICA FRANCISCA:
 SELECT NOME FROM PACIENTE WHERE CPF NOT IN (SELECT CPF FROM CONSULTA WHERE CRM IN
										 (SELECT CRM FROM MEDICO WHERE NOME ='FRANCISCA'));
 --OBTER O NOME DOS PACIENTES QUE FORAM ATENDIDOS POR TODOS OS MEDICOS CADASTRADOS NA CLINICA:
 SELECT NOME FROM PACIENTE WHERE CPF IN
 (SELECT CPF FROM CONSULTA WHERE CRM IN
 (SELECT CRM FROM MEDICO))
 
 --OBTER TODAS AS INFORMAÇÕES DOS PACIENTES QUE NASCERAM ANTES DO ANO 1990:
 SELECT * FROM PACIENTE WHERE DT_NASC < '1990-01-01'

--OBTER O NOME DOS PACIENTES QUE SE CONSULTARAM COM MEDICOS DA ESPECIALIDADE NEUROLOGIA:
SELECT NOME FROM PACIENTE WHERE CPF IN
(SELECT CPF FROM CONSULTA WHERE CRM IN
(SELECT CRM FROM MEDICO WHERE COD_ESP IN
(SELECT COD_ESP FROM ESPECIALIDADE WHERE NOME='NEUROLOGIA')))

--OBTER O CRM E NOME DOS MEDICOS QUE NÃO REALIZARAM CONSULTAS NA CLINICA:
SELECT CRM,NOME FROM MEDICO WHERE CRM NOT IN
(SELECT CRM FROM CONSULTA)

/*OBTER O NOME DOS MEDICOS QUE TEM O VALOR DE ESPECIALIDADE MAIOR QUE A,
MEDIA DE TODAS AS OUTRAS.*/
SELECT NOME FROM MEDICO WHERE COD_ESP IN
(SELECT COD_ESP FROM ESPECIALIDADE WHERE VALOR >
(SELECT AVG(VALOR) FROM ESPECIALIDADE))

/*OBTER O NOME DO PACIENTE MAIS VELHO QUE FOI ATENDIDO PELO FUNCIONARIO DE NOME
HUGO OU CONSULTADO PELO MEDICO DE ESPECIALIDADE NEUROLOGIA*/
SELECT NOME FROM PACIENTE WHERE DT_NASC IN
(SELECT MIN(DT_NASC) FROM PACIENTE WHERE CPF IN
(SELECT CPF FROM CONSULTA WHERE MATRICULA IN
(SELECT MATRICULA FROM FUNCIONARIO WHERE NOME='HUGO') OR CRM IN
(SELECT CRM FROM MEDICO WHERE COD_ESP IN
(SELECT COD_ESP FROM ESPECIALIDADE WHERE NOME='NEUROLOGIA'))))

--REAJUSTAR O VALOR DA CONSULTA PARA -10% DO VALOR ATUAL:
UPDATE ESPECIALIDADE SET VALOR = VALOR * 0.9;

--OBTER O NOME DAS ESPECIALIDADES QUE POSSUEM PREÇOS ENTRE R$150 E R$250:
SELECT NOME FROM ESPECIALIDADE WHERE VALOR BETWEEN
150 AND 250;

--OBTER O NOME DAS ESPECIALIDADES QUE POSSUEM A PALAVRA NEUROLOGIA:
SELECT NOME FROM ESPECIALIDADE WHERE NOME LIKE '%NEUROLOGIA%';

SELECT COD_CONS FROM CONSULTA WHERE CRM IN
(SELECT CRM FROM MEDICO WHERE NOME='JOAQUIM') AND MATRICULA IN
(SELECT MATRICULA FROM FUNCIONARIO WHERE NOME='JULIA');

SELECT CPF FROM CONSULTA WHERE CRM IN(630255,632289,635712,636314);

SELECT * FROM CONSULTA WHERE CRM IN
(SELECT CRM FROM MEDICO WHERE NOME='MARIA');

SELECT COUNT(CRM) FROM MEDICO;

SELECT SUM(VALOR) FROM ESPECIALIDADE;

SELECT AVG(VALOR) FROM ESPECIALIDADE;

SELECT MAX(VALOR) FROM ESPECIALIDADE;

SELECT MIN(VALOR) FROM ESPECIALIDADE;

SELECT NOME FROM PACIENTE WHERE DT_NASC>'1970-01-01';

SELECT COUNT(CPF) FROM PACIENTE;

ALTER TABLE PACIENTE ADD COLUMN NACIONALIDADE VARCHAR(20) NOT NULL DEFAULT 'NÃO PREENCHIDO';

SELECT MIN(DT_NASC) FROM PACIENTE;

SELECT MAX(DT_NASC) FROM PACIENTE;

SELECT NOME FROM PACIENTE WHERE DT_NASC IN
(SELECT MIN(DT_NASC) FROM PACIENTE);

UPDATE ESPECIALIDADE SET VALOR= VALOR*1.11;

SELECT COUNT(CPF) FROM PACIENTE WHERE CPF IN
(SELECT CPF FROM CONSULTA WHERE CRM IN
(SELECT CRM FROM MEDICO WHERE COD_ESP IN
(SELECT COD_ESP FROM ESPECIALIDADE WHERE VALOR IN
(SELECT MAX(VALOR) FROM ESPECIALIDADE))));

SELECT NOME FROM PACIENTE WHERE CPF NOT IN
(SELECT CPF FROM CONSULTA WHERE CRM IN
(SELECT CRM FROM MEDICO WHERE COD_ESP IN
(SELECT COD_ESP FROM ESPECIALIDADE WHERE NOME='GASTROLOGIA')));

SELECT NOME FROM PACIENTE WHERE DT_NASC IN
(SELECT MIN(DT_NASC) FROM PACIENTE WHERE CPF IN
(SELECT CPF FROM CONSULTA WHERE MATRICULA IN
(SELECT MATRICULA FROM FUNCIONARIO WHERE DT_NASC IN
(SELECT MAX(DT_NASC) FROM FUNCIONARIO))));

SELECT NOME FROM ESPECIALIDADE WHERE VALOR IN
(SELECT MAX(VALOR) FROM ESPECIALIDADE WHERE COD_ESP IN
(SELECT COD_ESP FROM MEDICO WHERE CRM IN
(SELECT CRM FROM CONSULTA WHERE CPF IN
(SELECT CPF FROM PACIENTE WHERE DT_NASC IN
(SELECT MAX(DT_NASC) FROM PACIENTE)))));